<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.kh.mappers.ReservationMapper">


	<!-- 예약 목록 보기 테스트-->
	<select id="getReservationList" resultType="ReservationVo">
		select * from tbl_reservation
		where user_email = #{user_email} order by reserv_num desc
	</select>
	
	<!-- 시퀀스 값 얻기 -->
	<select id="getNextVal" resultType="int">
		select seq_reserv_num.nextval
		from dual
	</select>

	
	<!-- 예약 등록하기 테스트 -->
	<insert id="insertReservation">
		insert into tbl_reservation(reserv_num, room_num, user_email, room_reserv_start_date, room_reserv_end_date, reserv_price)
		values(seq_reserv_num.nextval, #{room_num}, #{user_email}, #{check_in}, #{check_out}, #{room_price_v})
	</insert>
	
	<!-- 예약취소하기 -->
	<delete id="cancelReservation">
		delete from tbl_reservation
		where reserv_num = #{reserv_num}
	</delete>
	
	<!-- 예약가능한지 알아보기 -->
	<select id="availableReserv" resultType="int"  parameterType="TestDto">
		select count(*) from tbl_room r where r.room_num = #{room_num} and r.room_num not in(
    		select v.room_num from tbl_reservation v where
				(room_reserv_start_date &gt; #{room_reserv_start_date} and room_reserv_end_date &lt;= #{room_reserv_end_date}) or
				(room_reserv_start_date &gt; #{room_reserv_start_date} and room_reserv_start_date &lt;= #{room_reserv_end_date}) or
				(room_reserv_end_date &gt; #{room_reserv_start_date} and room_reserv_end_date &lt;= #{room_reserv_end_date})
		)
		
	</select>
	
	<!-- 예약취소 가능한지 -->
	<select id="reservCancleAvailable" resultType="ReservationVo">
		select reserv_num from tbl_reservation where room_reserv_start_date &gt; sysdate and user_email = #{user_email}
	</select>
  
</mapper>